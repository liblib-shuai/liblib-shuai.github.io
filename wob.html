<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÊ®°ÂûãÁõ≤ÊµãÂπ≥Âè∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Âä†ËΩΩÂä®ÁîªÊ†∑Âºè */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        /* ÂäüËÉΩÈÄâÊã©Âô®Ê†∑Âºè */
        .function-selector {
            margin-bottom: 25px;
        }
        .function-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
        }
        .function-tab {
            background: none;
            border: none;
            padding: 10px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #718096;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        .function-tab:hover {
            background: #f7fafc;
            color: #4a5568;
        }
        .function-tab.active {
            background: #f7fafc;
            color: #667eea;
            border-bottom-color: #667eea;
        }
        .function-content {
            padding-top: 20px;
        }
        .file-input-group {
            margin-bottom: 20px;
        }
        .file-input { display: none; }
        .file-label {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .file-list {
            margin-top: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f1f5f9;
            background: #f8fafc;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-item:hover {
            background: #f1f5f9;
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        .file-name {
            font-weight: 500;
            color: #2d3748;
        }
        .file-size {
            color: #718096;
            font-size: 14px;
        }
        .file-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .file-status.success {
            background: #c6f6d5;
            color: #22543d;
        }
        .file-status.error {
            background: #fed7d7;
            color: #742a2a;
        }
        .file-status.loading {
            background: #bee3f8;
            color: #2a4365;
        }
        .delete-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .delete-btn:hover {
            background: #c53030;
            transform: scale(1.05);
        }
        .add-file-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        .add-file-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }
        .start-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
        .start-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .test-section {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .home-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .home-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .results-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .results-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .test-info {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-label {
            font-weight: 500;
            color: #4a5568;
            font-size: 14px;
        }
        .info-value {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .test-content { padding: 30px; }
        .input-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .input-text {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
            font-size: 16px;
            line-height: 1.6;
        }
        .input-images {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .input-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
        }
        .input-image:hover { 
            transform: scale(1.05); 
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .input-image::after {
            content: 'üîç';
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px;
            border-radius: 50%;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .input-image:hover::after {
            opacity: 1;
        }
        .output-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .output-grid.single-item {
            max-width: 600px;
            margin: 0 auto;
        }
        .output-grid.single-item .output-item {
            min-height: 300px;
        }
        .output-grid.single-item .media-container {
            min-height: 200px;
        }
        .output-grid.single-item .output-image {
            height: auto;
        }
        .output-item {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            min-height: 300px;
            max-height: 800px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .output-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .output-item.selected {
            border-color: #48bb78;
            background: #f0fff4;
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.2);
        }
        .output-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .output-image[src*=".mp4"], video.output-image {
            object-fit: contain;
            background: #f7fafc;
        }
        .media-container {
            position: relative;
            cursor: pointer;
            margin-bottom: 15px;
            min-height: 200px;
            max-height: 600px;
            border-radius: 8px;
            overflow: hidden;
        }
        .media-container:last-child {
            margin-bottom: 0;
        }
        .media-container .output-image {
            width: 100%;
            height: auto;
            object-fit: contain;
        }
        .media-container video.output-image {
            object-fit: contain;
            background: #f7fafc;
        }
        
        /* Áº©Áï•ÂõæÊ†∑Âºè */
        .thumbnail-container {
            position: relative;
            width: 100%;
            min-height: 200px;
            max-height: 600px;
            background: #f7fafc;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .thumbnail-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: all 0.3s ease;
            filter: blur(2px);
            transform: scale(1.1);
        }
        
        .thumbnail-image.loaded {
            filter: blur(0);
            transform: scale(1);
        }
        
        
        
        
        .full-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .full-image.loaded {
            opacity: 1;
        }
        
        .media-scroll-container {
            flex: 1;
            overflow-y: auto;
            max-height: 700px;
            padding-right: 5px;
        }
        .media-scroll-container::-webkit-scrollbar {
            width: 6px;
        }
        .media-scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .media-scroll-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        .media-scroll-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        .media-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 8px;
        }
        .media-container:hover .media-overlay {
            opacity: 1;
        }
        .zoom-icon {
            color: white;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 50%;
        }
        .output-info {
            text-align: center;
            font-weight: 500;
            color: #4a5568;
            margin-top: 10px;
            flex-shrink: 0;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            gap: 20px;
        }
        .preference-reason-section {
            flex: 1;
            max-width: 600px;
        }
        .preference-reason-label {
            display: block;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .preference-reason-textarea {
            width: 100%;
            min-height: 50px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
            background: white;
        }
        .preference-reason-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .preference-reason-textarea::placeholder {
            color: #a0aec0;
        }
        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .prev-btn {
            background: #718096;
            color: white;
        }
        .next-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .next-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }
        .results-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .results-nav {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .results-nav .home-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .results-nav .home-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .progress-overview {
            margin-bottom: 20px;
        }
        .progress-bar-container {
            height: 20px;
            background-color: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #48bb78;
            transition: width 0.3s ease;
        }
        .progress-text {
            text-align: center;
            font-weight: 500;
            color: #4a5568;
        }
        .model-comparison {
            margin-bottom: 20px;
        }
        .chart-container {
            height: 300px;
            background-color: #f7fafc;
            border-radius: 8px;
            overflow: hidden;
        }
        .elo-ranking {
            margin-bottom: 20px;
        }
        .elo-container {
            background-color: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        .elo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .elo-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .elo-item:last-child {
            margin-bottom: 0;
        }
        .elo-rank {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .rank-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }
        .rank-1 { background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0 0%, #e5e5e5 100%); }
        .rank-3 { background: linear-gradient(135deg, #cd7f32 0%, #daa520 100%); }
        .rank-other { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .model-name {
            font-weight: 500;
            color: #2d3748;
        }
        .elo-score {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .score-value {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        .score-change {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }
        .score-positive {
            background: #c6f6d5;
            color: #22543d;
        }
        .score-negative {
            background: #fed7d7;
            color: #742a2a;
        }
        .score-neutral {
            background: #e2e8f0;
            color: #4a5568;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .results-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .action-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .export-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .output-grid { grid-template-columns: 1fr; }
            .test-header { flex-direction: column; gap: 10px; }
            .test-controls { 
                flex-direction: column; 
                gap: 10px; 
                width: 100%;
            }
            .test-controls .nav-btn {
                width: 100%;
                margin: 0;
            }
            .navigation-buttons { flex-direction: column; gap: 15px; }
            .test-info { 
                flex-direction: column; 
                gap: 10px; 
            }
            .results-actions {
                flex-direction: column;
                gap: 10px;
            }
            .results-nav {
                justify-content: center;
            }
            .results-nav .home-btn {
                width: 100%;
                max-width: 200px;
            }
        }
        .media-modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-height: 80%;
            overflow: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .close-btn {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-body {
            text-align: center;
        }
        .modal-body img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .output-section {
            margin-bottom: 30px;
        }
        .keyboard-hint {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 14px;
            text-align: center;
        }
        .cache-controls {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .cache-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .cache-btn:hover {
            background: #c53030;
            transform: translateY(-1px);
        }
        .cache-info {
            margin-top: 10px;
            font-size: 14px;
            color: #4a5568;
        }
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }
        .detailed-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .model-detail {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .choice-details {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }
        .choice-item {
            padding: 10px;
            border-bottom: 1px solid #f1f5f9;
            margin-bottom: 10px;
        }
        .choice-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        /* ÊµãËØïËØ¶ÊÉÖÈÄâÊã©Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .test-detail-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .test-detail-modal .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .test-detail-modal .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-detail-modal .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }
        
        .test-detail-modal .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .test-navigation h4 {
            margin: 0 0 20px 0;
            color: #2d3748;
            font-size: 18px;
        }
        
        .test-list {
            display: grid;
            gap: 15px;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8fafc;
        }
        
        .test-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        
        .test-item.completed {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .test-item.incomplete {
            border-color: #ed8936;
            background: #fffaf0;
        }
        
        .test-info {
            flex: 1;
        }
        
        .test-number {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .test-id {
            font-size: 14px;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .test-models {
            font-size: 16px;
            color: #4a5568;
            font-weight: 500;
        }
        
        .test-status {
            text-align: right;
        }
        
        .status-text {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .test-item.completed .status-text {
            color: #22543d;
        }
        
        .test-item.incomplete .status-text {
            color: #744210;
        }
        
        .selected-model {
            font-size: 12px;
            color: #718096;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }
        
        /* ÂØºÂÖ•ÁªìÊûúËØ¶ÊÉÖÊ†∑Âºè */
        .imported-result-details {
            padding: 20px 0;
        }
        
        .imported-result-details h4 {
            color: #2d3748;
            margin: 20px 0 15px 0;
            font-size: 18px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }
        
        .result-overview {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
        }
        
        .result-overview p {
            margin: 8px 0;
            color: #4a5568;
        }
        
        .choice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .choice-number {
            font-weight: 600;
            color: #667eea;
            font-size: 16px;
        }
        
        .choice-time {
            font-size: 12px;
            color: #718096;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .choice-content p {
            margin: 6px 0;
            color: #4a5568;
        }
        
        .selected-model-highlight {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .imported-result-note {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .imported-result-note p {
            color: #742a2a;
            margin: 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AIÊ®°ÂûãÁõ≤ÊµãÂπ≥Âè∞</h1>
            <p>ÂÆ¢ËßÇËØÑ‰º∞‰∏çÂêåAIÊ®°ÂûãÁöÑËæìÂá∫Ë¥®ÈáèÔºåÈÄâÊã©ÊÇ®ËÆ§‰∏∫ÊúÄÂ•ΩÁöÑÁªìÊûú</p>
        </div>

        <div class="upload-section" id="uploadSection">
            <h2>üìÅ ÂØºÂÖ•ÊµãËØïÊï∞ÊçÆ</h2>
            
            <!-- ÂäüËÉΩÈÄâÊã© -->
            <div class="function-selector">
                <div class="function-tabs">
                    <button class="function-tab active" id="newTestTab" onclick="switchFunction('newTest')">üÜï Êñ∞Âª∫ÊµãËØï</button>
                    <button class="function-tab" id="importResultsTab" onclick="switchFunction('importResults')">üìä ÂØºÂÖ•ÁªìÊûú</button>
                </div>
            </div>
            
            <!-- Êñ∞Âª∫ÊµãËØïÂå∫Âüü -->
            <div class="function-content" id="newTestContent">
                <div class="file-input-group">
                    <label>ËæìÂÖ•Êñá‰ª∂ (JSONÊ†ºÂºè) - ‰ªÖÈôê‰∏Ä‰∏™Êñá‰ª∂</label>
                    <input type="file" id="inputFile" class="file-input" accept=".json">
                    <label for="inputFile" class="file-label">üìÑ ÈÄâÊã©ËæìÂÖ•Êñá‰ª∂</label>
                    <div class="file-list" id="inputFileList">
                        <div style="padding: 20px; text-align: center; color: #718096;">
                            ÁÇπÂáª‰∏äÊñπÊåâÈíÆÈÄâÊã©ËæìÂÖ•Êñá‰ª∂Ôºà‰ªÖÈôê‰∏Ä‰∏™Ôºâ
                        </div>
                    </div>
                </div>

                <div class="file-input-group">
                    <label>ËæìÂá∫ÁªìÊûúÊñá‰ª∂ (JSONÊ†ºÂºè) - ‰∏çÊîØÊåÅÂêåÂêçÊñá‰ª∂</label>
                    <input type="file" id="outputFileInput" class="file-input" accept=".json" multiple>
                    <label for="outputFileInput" class="file-label">üìÑ ÈÄâÊã©ËæìÂá∫Êñá‰ª∂</label>
                    <div class="file-list" id="outputFileList">
                        <div style="padding: 20px; text-align: center; color: #718096;">
                            ÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†ËæìÂá∫Êñá‰ª∂Ôºà‰∏çÊîØÊåÅÂêåÂêçÊñá‰ª∂Ôºâ
                        </div>
                    </div>
                </div>

                <div class="cache-controls">
                    <button class="cache-btn" id="clearCacheBtn" onclick="clearAllCache()">üóëÔ∏è Ê∏ÖÈô§ÊâÄÊúâÁºìÂ≠ò</button>
                    <div class="cache-info" id="cacheInfo"></div>
                </div>

                <button class="start-btn" id="startBtn" disabled>üöÄ ÂºÄÂßãÊµãËØï</button>
            </div>

            <!-- ÂØºÂÖ•ÁªìÊûúÂå∫Âüü -->
            <div class="function-content" id="importResultsContent" style="display: none;">
                <div class="file-input-group">
                    <label>ÊµãËØïÁªìÊûúÊñá‰ª∂ (JSONÊ†ºÂºè)</label>
                    <input type="file" id="resultsFile" class="file-input" accept=".json">
                    <label for="resultsFile" class="file-label">üìÑ ÈÄâÊã©ÁªìÊûúÊñá‰ª∂</label>
                    <div class="file-info" id="resultsFileInfo"></div>
                </div>

                <button class="start-btn" id="importResultsBtn" disabled>üìä Êü•ÁúãÁªìÊûú</button>
            </div>
        </div>

        <div class="test-section" id="testSection">
            <div class="test-header">
                <h2>üß™ Áõ≤ÊµãËøõË°å‰∏≠</h2>
                <div class="test-controls">
                    <button class="nav-btn home-btn" onclick="goHome()">üè† ÂõûÂà∞ÂºÄÂßã</button>
                    <button class="nav-btn results-btn" onclick="showResults()">üìä Êü•ÁúãÁªìÊûú</button>
                    <div class="progress-info" id="progressInfo">Á¨¨ 1 È¢ò / ÂÖ± 0 È¢ò</div>
                </div>
            </div>

            <div class="test-content">
                <div class="input-section">
                    <h3>üìù ËæìÂÖ•ÂÜÖÂÆπ</h3>
                    <div class="test-info" id="testInfo">
                        <div class="info-item">
                            <span class="info-label">ÊµãËØïID:</span>
                            <span class="info-value" id="currentTestId">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ÁªÑÂêàID:</span>
                            <span class="info-value" id="currentCombinationId">-</span>
                        </div>
                    </div>
                    <div class="input-text" id="inputText"></div>
                    <div class="input-images" id="inputImages"></div>
                </div>

                <div class="output-section">
                    <h3>üé® ËØ∑ÈÄâÊã©ÊÇ®ËÆ§‰∏∫ÊúÄÂ•ΩÁöÑËæìÂá∫ÁªìÊûú</h3>
                    <div class="keyboard-hint">üí° ÊèêÁ§∫Ôºö‚Üê ‚Üí ÈÄâÊã©Á≠îÊ°à | ‚Üë ‚Üì Âø´ÈÄüÂØºËà™ | EnterÁ°ÆËÆ§Âπ∂ËøõÂÖ•‰∏ã‰∏ÄÈ¢ò</div>
                    <div class="output-grid" id="outputGrid"></div>
                </div>

                <div class="navigation-buttons">
                    <button class="nav-btn prev-btn" id="prevBtn">‚¨ÖÔ∏è ‰∏ä‰∏ÄÈ¢ò</button>
                    <div class="preference-reason-section">
                        <label class="preference-reason-label" for="preferenceReason">üí≠ ÂÅèÂ•ΩÂéüÂõ†ÔºàÂèØÈÄâÔºâ</label>
                        <textarea
                            id="preferenceReason"
                            class="preference-reason-textarea"
                            placeholder="ËØ∑ÊèèËø∞ÊÇ®ÈÄâÊã©ËØ•ÁªìÊûúÁöÑÂéüÂõ†Ôºå‰æãÂ¶ÇÔºöÂõæÁâáË¥®ÈáèÊõ¥Â•Ω„ÄÅÂàõÊÑèÊõ¥‰∏∞ÂØå„ÄÅÊõ¥Á¨¶ÂêàË¶ÅÊ±ÇÁ≠â..."
                            onchange="savePreferenceReason()"
                        ></textarea>
                    </div>
                    <button class="nav-btn next-btn" id="nextBtn">‰∏ã‰∏ÄÈ¢ò ‚û°Ô∏è</button>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <h2>üìä ÊµãËØïÁªìÊûúÁªüËÆ°</h2>

            <!-- ÂØºËà™ÊåâÈíÆ -->
            <div class="results-nav">
                <button class="nav-btn home-btn" onclick="goHome()">üè† ÂõûÂà∞ÂºÄÂßã</button>
            </div>

            <!-- ËøõÂ∫¶Ê¶ÇËßà -->
            <div class="progress-overview" id="progressOverview">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
            </div>

            <!-- Ê®°ÂûãÂØπÊØîÂõæË°® -->
            <div class="model-comparison" id="modelComparison">
                <h3>üèÜ Ê®°ÂûãË°®Áé∞ÂØπÊØî</h3>
                <div class="chart-container" id="chartContainer"></div>
            </div>

            <!-- ELOËØÑÂàÜÊéíÂêç -->
            <div class="elo-ranking" id="eloRanking">
                <h3>üìà ELOËØÑÂàÜÊéíÂêç</h3>
                <div class="elo-container" id="eloContainer"></div>
            </div>

            <!-- ËØ¶ÁªÜÁªüËÆ° -->
            <div class="summary-stats" id="summaryStats"></div>

            <!-- Êìç‰ΩúÊåâÈíÆ -->
            <div class="results-actions">
                <button class="action-btn" id="viewDetailsBtn" onclick="showDetailedResults()">üìã Êü•ÁúãËØ¶ÁªÜÁªìÊûú</button>
                <button class="action-btn" id="continueTestBtn" onclick="continueTest()">üîÑ ÁªßÁª≠ÊµãËØï</button>
                <button class="export-btn" id="exportBtn">üíæ ÂØºÂá∫ÁªìÊûú</button>
            </div>
        </div>

        <!-- Â™í‰ΩìÊ®°ÊÄÅÊ°Ü -->
        <div class="media-modal" id="mediaModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Â™í‰ΩìÈ¢ÑËßà</h3>
                    <button class="close-btn" onclick="closeMediaModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="modalMedia"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testData = {
            inputData: {},
            outputData: [],
            currentIndex: 0,
            userPreferences: {},
            preferenceReasons: {},
            totalQuestions: 0
        };
        let outputModels = [];
        let uploadedFiles = [];
        let currentTestKey = null; // ÂΩìÂâçÊµãËØïÁöÑÂîØ‰∏ÄÊ†áËØÜ
        let inputFileItem = null; // Êñ∞Â¢ûÔºöËæìÂÖ•Êñá‰ª∂È°π

        const uploadSection = document.getElementById('uploadSection');
        const testSection = document.getElementById('testSection');
        const resultsSection = document.getElementById('resultsSection');
        const startBtn = document.getElementById('startBtn');
        const inputFile = document.getElementById('inputFile');
        const outputFileInput = document.getElementById('outputFileInput');
        const outputFileList = document.getElementById('outputFileList');
        const importResultsBtn = document.getElementById('importResultsBtn');
        const resultsFile = document.getElementById('resultsFile');

        inputFile.addEventListener('change', handleInputFileChange);
        outputFileInput.addEventListener('change', handleOutputFileAdd);
        startBtn.addEventListener('click', startTest);
        resultsFile.addEventListener('change', handleResultsFileChange);
        importResultsBtn.addEventListener('click', importResults);

        // Ê∑ªÂä†ÈîÆÁõò‰∫ã‰ª∂ÁõëÂê¨Âô®
        document.addEventListener('keydown', handleKeyDown);

        // ÂäüËÉΩÂàáÊç¢ÂáΩÊï∞
        function switchFunction(functionType) {
            const newTestTab = document.getElementById('newTestTab');
            const importResultsTab = document.getElementById('importResultsTab');
            const newTestContent = document.getElementById('newTestContent');
            const importResultsContent = document.getElementById('importResultsContent');

            if (functionType === 'newTest') {
                newTestTab.classList.add('active');
                importResultsTab.classList.remove('active');
                newTestContent.style.display = 'block';
                importResultsContent.style.display = 'none';
            } else if (functionType === 'importResults') {
                importResultsTab.classList.add('active');
                newTestTab.classList.remove('active');
                importResultsContent.style.display = 'block';
                newTestContent.style.display = 'none';
            }
        }

        // Â§ÑÁêÜÁªìÊûúÊñá‰ª∂ÈÄâÊã©
        function handleResultsFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('resultsFileInfo').textContent =
                    `Â∑≤ÈÄâÊã©: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                importResultsBtn.disabled = false;
            }
        }

        // ÂØºÂÖ•ÁªìÊûúÂáΩÊï∞
        async function importResults() {
            try {
                const file = resultsFile.files[0];
                if (!file) {
                    alert('ËØ∑ÈÄâÊã©ÁªìÊûúÊñá‰ª∂');
                    return;
                }

                const resultData = await readFileAsJSON(file);

                // È™åËØÅÁªìÊûúÊñá‰ª∂Ê†ºÂºè - ÈÄÇÈÖçÂÆûÈôÖÁöÑÁªìÊûúÊñá‰ª∂ÁªìÊûÑ
                if (!resultData.userPreferences) {
                    throw new Error('ÁªìÊûúÊñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåÁº∫Â∞ëuserPreferencesÂ≠óÊÆµ');
                }

                // ËÆæÁΩÆÊµãËØïÊï∞ÊçÆ - ÈÄÇÈÖçÂÆûÈôÖÁöÑÁªìÊûúÊñá‰ª∂ÁªìÊûÑ
                testData = {
                    inputData: resultData.inputInfo || {}, // ‰ΩøÁî®inputInfoËÄå‰∏çÊòØinputData
                    outputData: [], // ÁªìÊûúÊñá‰ª∂‰∏≠Ê≤°ÊúâoutputDataÔºåÈúÄË¶Å‰ªéuserPreferencesÈáçÂª∫
                    currentIndex: 0,
                    userPreferences: resultData.userPreferences,
                    totalQuestions: resultData.testInfo?.totalQuestions || 0,
                    isImportedResult: true // Ê†áËÆ∞ËøôÊòØÂØºÂÖ•ÁöÑÁªìÊûú
                };

                // ‰ªéuserPreferencesÈáçÂª∫outputDataÂíåoutputModels
                const modelNames = new Set();
                Object.values(resultData.userPreferences).forEach(pref => {
                    if (pref.model1Name) modelNames.add(pref.model1Name);
                    if (pref.model2Name) modelNames.add(pref.model2Name);
                });

                outputModels = Array.from(modelNames);

                // Áõ¥Êé•ÊòæÁ§∫ÁªìÊûúÈ°µÈù¢
                uploadSection.style.display = 'none';
                testSection.style.display = 'none';
                resultsSection.style.display = 'block';

                // ÊòæÁ§∫Ê†áÈ¢òÂå∫Âüü
                document.querySelector('.header').style.display = 'block';

                // ÊòæÁ§∫ÁªìÊûú
                displayResults();

            } catch (error) {
                alert('ÂØºÂÖ•ÁªìÊûúÂ§±Ë¥•: ' + error.message);
            }
        }

        function handleInputFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊúâËæìÂÖ•Êñá‰ª∂
                if (inputFileItem) {
                    alert('Âè™ËÉΩÂØºÂÖ•‰∏Ä‰∏™ËæìÂÖ•Êñá‰ª∂„ÄÇËØ∑ÂÖàÂà†Èô§ÂΩìÂâçËæìÂÖ•Êñá‰ª∂„ÄÇ');
                    event.target.value = ''; // Ê∏ÖÁ©∫Êñá‰ª∂ÈÄâÊã©
                    return;
                }

                inputFileItem = {
                    file: file,
                    name: file.name,
                    size: file.size,
                    status: 'loading',
                    data: null
                };
                updateInputFileList();
                loadInputFileData(inputFileItem);
            }
        }

        function loadInputFileData(fileItem) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    fileItem.data = data;
                    fileItem.status = 'success';
                    updateInputFileList();
                    checkStartButton();
                } catch (error) {
                    fileItem.status = 'error';
                    updateInputFileList();
                    alert('ËæìÂÖ•Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•: ' + fileItem.name + ' - ' + error.message);
                }
            };
            reader.onerror = () => {
                fileItem.status = 'error';
                updateInputFileList();
                alert('ËæìÂÖ•Êñá‰ª∂ËØªÂèñÂ§±Ë¥•: ' + fileItem.name);
            };
            reader.readAsText(fileItem.file);
        }

        function updateInputFileList() {
            const inputFileList = document.getElementById('inputFileList');
            if (!inputFileItem) {
                inputFileList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #718096;">
                        ÁÇπÂáª‰∏äÊñπÊåâÈíÆÈÄâÊã©ËæìÂÖ•Êñá‰ª∂Ôºà‰ªÖÈôê‰∏Ä‰∏™Ôºâ
                    </div>
                `;
                return;
            }

            inputFileList.innerHTML = `
                <div class="file-item">
                    <div class="file-info">
                        <span class="file-name">${inputFileItem.name}</span>
                        <span class="file-size">(${(inputFileItem.size / 1024).toFixed(1)} KB)</span>
                        <span class="file-status ${inputFileItem.status}">
                            ${inputFileItem.status === 'loading' ? 'Âä†ËΩΩ‰∏≠...' :
                              inputFileItem.status === 'success' ? '‚úì Â∑≤Âä†ËΩΩ' : '‚úó ÈîôËØØ'}
                        </span>
                    </div>
                    <button class="delete-btn" onclick="removeInputFile()">Âà†Èô§</button>
                </div>
            `;
        }

        function removeInputFile() {
            inputFileItem = null;
            document.getElementById('inputFile').value = '';
            updateInputFileList();
            checkStartButton();
        }

        function handleOutputFileAdd(event) {
            const files = event.target.files;
            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    addOutputFile(files[i]);
                }
            }
        }

        function addOutputFile(file) {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÂêåÂêçÊñá‰ª∂
            const existingFile = uploadedFiles.find(f => f.name === file.name);
            if (existingFile) {
                alert(`Êñá‰ª∂ "${file.name}" Â∑≤Â≠òÂú®Ôºå‰∏çËÉΩÈáçÂ§çÂØºÂÖ•ÂêåÂêçÊñá‰ª∂„ÄÇ`);
                return;
            }

            const fileItem = {
                file: file,
                name: file.name,
                size: file.size,
                status: 'loading',
                data: null
            };

            uploadedFiles.push(fileItem);
            updateFileList();
            loadFileData(fileItem);
        }

        function loadFileData(fileItem) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    fileItem.data = data;
                    fileItem.status = 'success';
                    updateFileList();
                    checkStartButton();
                } catch (error) {
                    fileItem.status = 'error';
                    updateFileList();
                    alert('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•: ' + fileItem.name + ' - ' + error.message);
                }
            };
            reader.onerror = () => {
                fileItem.status = 'error';
                updateFileList();
                alert('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•: ' + fileItem.name);
            };
            reader.readAsText(fileItem.file);
        }

        function removeOutputFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            checkStartButton();
        }

        function updateFileList() {
            if (uploadedFiles.length === 0) {
                outputFileList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #718096;">
                        ÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†ËæìÂá∫Êñá‰ª∂Ôºà‰∏çÊîØÊåÅÂêåÂêçÊñá‰ª∂Ôºâ
                    </div>
                `;
                return;
            }

            outputFileList.innerHTML = uploadedFiles.map((fileItem, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <span class="file-name">${fileItem.name}</span>
                        <span class="file-size">(${(fileItem.size / 1024).toFixed(1)} KB)</span>
                        <span class="file-status ${fileItem.status}">
                            ${fileItem.status === 'loading' ? 'Âä†ËΩΩ‰∏≠...' : 
                              fileItem.status === 'success' ? '‚úì Â∑≤Âä†ËΩΩ' : '‚úó ÈîôËØØ'}
                        </span>
                    </div>
                    <button class="delete-btn" onclick="removeOutputFile(${index})">Âà†Èô§</button>
                </div>
            `).join('');
        }

        function checkStartButton() {
            const hasInput = inputFileItem && inputFileItem.status === 'success';
            const hasValidOutputs = uploadedFiles.filter(f => f.status === 'success').length >= 2;
            startBtn.disabled = !(hasInput && hasValidOutputs);
        }

        function validateData(inputData, outputData) {
            if (!inputData || typeof inputData !== 'object') {
                throw new Error('ËæìÂÖ•Êï∞ÊçÆÊ†ºÂºèÈîôËØØ');
            }
            if (!outputData || outputData.length < 2) {
                throw new Error('Ëá≥Â∞ëÈúÄË¶Å2‰∏™ËæìÂá∫Êñá‰ª∂ËøõË°åÂØπÊØî');
            }
            
            const inputKeys = Object.keys(inputData).filter(key => key !== 'test_info');
            const validTestIds = new Set();
            
            // Ê£ÄÊü•ÊØè‰∏™ËæìÂá∫Êñá‰ª∂ÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÊî∂ÈõÜÊâÄÊúâÊúâÊïàÁöÑtest_id
            for (let output of outputData) {
                const outputKeys = Object.keys(output.data).filter(key => key !== 'test_info');
                
                // Ê£ÄÊü•ÊØè‰∏™test_idÁöÑÊúâÊïàÊÄß
                for (let testId of outputKeys) {
                    const resultItem = output.data[testId];
                    if (isValidOutput(resultItem)) {
                        // Ê£ÄÊü•ËæìÂÖ•Êñá‰ª∂‰∏≠ÊòØÂê¶ÊúâÂØπÂ∫îÁöÑtest_id
                        if (inputData[testId]) {
                            validTestIds.add(testId);
                        } else {
                            console.warn(`ËæìÂá∫Êñá‰ª∂ ${output.name} ‰∏≠ÁöÑ test_id ${testId} Âú®ËæìÂÖ•Êñá‰ª∂‰∏≠‰∏çÂ≠òÂú®`);
                        }
                    }
                }
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâË∂≥Â§üÁöÑÊúâÊïàtest_id
            if (validTestIds.size === 0) {
                throw new Error('Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑÊµãËØïÁî®‰æãÔºàËæìÂá∫ÊúâÊïà‰∏îËæìÂÖ•Â≠òÂú®Ôºâ');
            }
            
            console.log(`ÊâæÂà∞ ${validTestIds.size} ‰∏™ÊúâÊïàÊµãËØïÁî®‰æã:`, Array.from(validTestIds));
            console.log(`ËæìÂÖ•Êñá‰ª∂ÂåÖÂê´ ${inputKeys.length} ‰∏™test_id:`, inputKeys);
            return Array.from(validTestIds);
        }

        function isValidOutput(outputItem) {
            if (!outputItem || !outputItem.output_display_info) {
                return false;
            }
            
            // Ê£ÄÊü•output_display_infoÁªìÊûÑ
            const displayInfo = outputItem.output_display_info;
            if (!displayInfo.output_images && !displayInfo.output_videos) {
                return false;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÊúâÊïàÁöÑÂ™í‰ΩìÂÜÖÂÆπ
            const hasImages = displayInfo.output_images && Array.isArray(displayInfo.output_images) && displayInfo.output_images.length > 0;
            const hasVideos = displayInfo.output_videos && Array.isArray(displayInfo.output_videos) && displayInfo.output_videos.length > 0;
            
            // Â¶ÇÊûúoutput_imagesÂíåoutput_videosÈÉΩ‰∏∫Á©∫ÔºåÂàôËÆ§‰∏∫ÊòØÊó†ÊïàËæìÂá∫
            return hasImages || hasVideos;
        }

        function generateTestCombinations(outputData, validTestIds) {
            const combinations = [];
            const modelCount = outputData.length;
            
            // ÁîüÊàêC(n,2)ÁªÑÂêà
            for (let i = 0; i < modelCount; i++) {
                for (let j = i + 1; j < modelCount; j++) {
                    const model1 = outputData[i];
                    const model2 = outputData[j];
                    
                    // ‰∏∫ÊØè‰∏™ÊúâÊïàÁöÑtest_idÂàõÂª∫ÂØπÊØîÁªÑÂêà
                    for (let testId of validTestIds) {
                        // Ê£ÄÊü•‰∏§‰∏™Ê®°ÂûãÂú®Ëøô‰∏™test_id‰∏äÈÉΩÊúâÊúâÊïàËæìÂá∫
                        if (isValidOutput(model1.data[testId]) && isValidOutput(model2.data[testId])) {
                            combinations.push({
                                testId: testId,
                                model1: {
                                    name: model1.name,
                                    index: i,
                                    data: model1.data[testId]
                                },
                                model2: {
                                    name: model2.name,
                                    index: j,
                                    data: model2.data[testId]
                                }
                            });
                        }
                    }
                }
            }
            
            return combinations;
        }

        async function startTest() {
            try {
                // Ê∏ÖÁêÜÈ¢ÑÂä†ËΩΩÁºìÂ≠ò
                preloadManager.clearCache();
                
                if (!inputFileItem || inputFileItem.status !== 'success') {
                    throw new Error('ËØ∑ÂÖàÈÄâÊã©Âπ∂Âä†ËΩΩÊúâÊïàÁöÑËæìÂÖ•Êñá‰ª∂');
                }
                
                const inputFileData = inputFileItem.data;
                const validOutputFiles = uploadedFiles.filter(f => f.status === 'success');
                
                if (validOutputFiles.length < 2) {
                    throw new Error('Ëá≥Â∞ëÈúÄË¶Å2‰∏™ÊúâÊïàÁöÑËæìÂá∫Êñá‰ª∂ËøõË°åÂØπÊØî');
                }

                const outputData = validOutputFiles.map(fileItem => {
                    // ‰ªétest_info.test_versionËé∑ÂèñÁâàÊú¨‰ø°ÊÅØ‰Ωú‰∏∫Ê®°ÂûãÂêçÁß∞
                    let modelName = "Unknown Model";
                    if (fileItem.data.test_info && fileItem.data.test_info.test_version) {
                        modelName = fileItem.data.test_info.test_version;
                    } else {
                        // Â§áÁî®ÊñπÊ°àÔºö‰ªéÊñá‰ª∂ÂêçÊèêÂèñ
                        modelName = fileItem.name.replace('.json', '').replace('output_', '').replace('_', ' ');
                    }
                    return { name: modelName, data: fileItem.data };
                });

                outputModels = outputData.map(item => item.name);

                // È™åËØÅÊï∞ÊçÆÂπ∂Ëé∑ÂèñÊúâÊïàÁöÑtest_id
                const validTestIds = validateData(inputFileData, outputData);
                
                // ÁîüÊàêÊµãËØïÁªÑÂêà
                const testCombinations = generateTestCombinations(outputData, validTestIds);
                
                if (testCombinations.length === 0) {
                    throw new Error('Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑÊµãËØïÁªÑÂêà');
                }

                console.log(`ÁîüÊàê‰∫Ü ${testCombinations.length} ‰∏™ÊµãËØïÁªÑÂêà`);
                console.log('ÊµãËØïÁªÑÂêàËØ¶ÊÉÖ:', testCombinations);

                // ÁîüÊàêÊµãËØïÂîØ‰∏ÄÊ†áËØÜ
                currentTestKey = generateTestKey(inputFileData, outputData);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèØÊÅ¢Â§çÁöÑÊµãËØï
                let shouldResume = false;
                const resumeResult = checkForResumableTest(inputFileData, outputData);
                
                // Â¶ÇÊûúcheckForResumableTestËøîÂõûÁâπÊÆäÂÄºÔºåËØ¥ÊòéÂ∑≤ÁªèÂ§ÑÁêÜ‰∫ÜÂ∑≤ÂÆåÊàêÊµãËØïÁöÑÊÉÖÂÜµ
                // Ê≠§Êó∂Â∫îËØ•Áõ¥Êé•ËøîÂõûÔºå‰∏çÁªßÁª≠ÊâßË°åstartTestÊµÅÁ®ã
                if (resumeResult === 'completed') {
                    return; // Áõ¥Êé•ËøîÂõûÔºå‰∏çÁªßÁª≠ÊâßË°å
                }
                
                // checkForResumableTestÂáΩÊï∞Â∑≤ÁªèÂ§ÑÁêÜ‰∫ÜÊâÄÊúâÊÉÖÂÜµÔºåÂåÖÊã¨Â∑≤ÂÆåÊàêÊµãËØïÁöÑÁõ¥Êé•Ë∑≥ËΩ¨
                // Â¶ÇÊûúËøîÂõûtrueÔºåËØ¥ÊòéÁî®Êà∑ÈÄâÊã©ÁªßÁª≠Êú™ÂÆåÊàêÁöÑÊµãËØï
                // Â¶ÇÊûúËøîÂõûfalseÔºåËØ¥ÊòéÊ≤°ÊúâÁºìÂ≠òÊàñÁî®Êà∑ÈÄâÊã©ÈáçÊñ∞ÂºÄÂßã
                shouldResume = resumeResult === true;

                testData.inputData = inputFileData;
                testData.outputData = outputData;
                testData.testCombinations = testCombinations;
                testData.totalQuestions = testCombinations.length;
                testData.isImportedResult = false; // ÈáçÁΩÆÂØºÂÖ•ÁªìÊûúÊ†áËÆ∞

                if (shouldResume) {
                    // ÊÅ¢Â§ç‰πãÂâçÁöÑËøõÂ∫¶
                    loadTestProgress(currentTestKey);
                } else {
                    // ÂºÄÂßãÊñ∞ÁöÑÊµãËØï
                    testData.currentIndex = 0;
                    testData.userPreferences = {};
                }

                showTestSection();
                loadCurrentQuestion();
                updateCacheInfo();
                
                // Âú®ÊµãËØïÂºÄÂßãÊó∂Â∞±ÂºÄÂßãÈ¢ÑÂä†ËΩΩÁº©Áï•Âõæ
                setTimeout(() => {
                    smartPreloadThumbnails(0);
                }, 500); // Âª∂Ëøü500msÔºåÁ°Æ‰øùÁ¨¨‰∏ÄÈ°µÂÆåÂÖ®Âä†ËΩΩÂêéÂÜçÂºÄÂßãÈ¢ÑÂä†ËΩΩ

            } catch (error) {
                alert('ÂêØÂä®ÊµãËØïÂ§±Ë¥•: ' + error.message);
            }
        }

        function readFileAsJSON(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        resolve(data);
                    } catch (error) {
                        reject(new Error('JSONËß£ÊûêÂ§±Ë¥•: ' + error.message));
                    }
                };
                reader.onerror = () => reject(new Error('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•'));
                reader.readAsText(file);
            });
        }

        function showTestSection() {
            uploadSection.style.display = 'none';
            testSection.style.display = 'block';
            resultsSection.style.display = 'none';
            
            // ÈöêËóèÊ†áÈ¢òÂå∫Âüü‰ª•ËäÇÁúÅÁ©∫Èó¥
            document.querySelector('.header').style.display = 'none';
        }

        function loadCurrentQuestion() {
            const currentCombination = testData.testCombinations[testData.currentIndex];
            const inputItem = testData.inputData[currentCombination.testId];

            document.getElementById('progressInfo').textContent = 
                `Á¨¨ ${testData.currentIndex + 1} È¢ò / ÂÖ± ${testData.totalQuestions} È¢ò`;

            // ÊòæÁ§∫ÊµãËØï‰ø°ÊÅØ
            document.getElementById('currentTestId').textContent = currentCombination.testId;
            document.getElementById('currentCombinationId').textContent = 
                `${currentCombination.model1.index}-${currentCombination.model2.index}`;

            displayInput(inputItem);
            displayOutputs(currentCombination);
            updateNavigationButtons();
            loadPreferenceReason();

            // ÊòæÁ§∫‰πãÂâçÁöÑÈÄâÊã©Áä∂ÊÄÅ
            const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;
            if (testData.userPreferences[combinationKey]) {
                const selectedModelIndex = testData.userPreferences[combinationKey].selectedModelIndex;
                const outputItems = document.querySelectorAll('.output-item');
                outputItems.forEach((item, index) => {
                    if (parseInt(item.dataset.modelIndex) === selectedModelIndex) {
                        item.classList.add('selected');
                    }
                });
            }
            
            // Á´ãÂç≥ÂºÄÂßãÈ¢ÑÂä†ËΩΩ‰∏ã‰∏ÄÈ°µÁöÑÁº©Áï•Âõæ
            if (testData.currentIndex < testData.totalQuestions - 1) {
                // ‰ΩøÁî®Êô∫ËÉΩÈ¢ÑÂä†ËΩΩÔºåÈ¢ÑÂä†ËΩΩÂ§öÈ°µÁº©Áï•Âõæ
                if (window.requestIdleCallback) {
                    requestIdleCallback(() => {
                        smartPreloadThumbnails(testData.currentIndex);
                    });
                } else {
                    setTimeout(() => {
                        smartPreloadThumbnails(testData.currentIndex);
                    }, 100); // Áü≠ÊöÇÂª∂ËøüÔºåÁ°Æ‰øùÂΩìÂâçÈ°µÈù¢‰ºòÂÖàÊ∏≤Êüì
                }
            }
        }

        function displayInput(inputItem) {
            const inputText = document.getElementById('inputText');
            const inputImages = document.getElementById('inputImages');

            const texts = inputItem.input_display_info?.input_texts || [];
            inputText.textContent = texts.join(' ');

            const images = inputItem.input_display_info?.input_images || [];
            inputImages.innerHTML = '';
            
            images.forEach((imageUrl, index) => {
                // ‰∏∫OSSÂõæÁâáÁîüÊàêÁº©Áï•ÂõæURL
                const thumbnailUrl = `${imageUrl}?x-oss-process=image/format,webp,image/resize,w_512,h_512`;
                const img = document.createElement('img');
                img.src = thumbnailUrl;
                img.className = 'input-image';
                img.onclick = () => showMediaModal(imageUrl, 'image', `ËæìÂÖ•ÂõæÁâá ${index + 1}`);
                inputImages.appendChild(img);
            });
        }

        function displayOutputs(combination) {
            const outputGrid = document.getElementById('outputGrid');
            outputGrid.innerHTML = '';

            const outputs = [];
            
            // Â§ÑÁêÜmodel1ÁöÑËæìÂá∫
            const model1Outputs = extractDisplayInfo(combination.model1.data);
            if (model1Outputs.length > 0) {
                outputs.push({
                    modelName: combination.model1.name,
                    mediaItems: model1Outputs,
                    modelIndex: combination.model1.index
                });
            }
            
            // Â§ÑÁêÜmodel2ÁöÑËæìÂá∫
            const model2Outputs = extractDisplayInfo(combination.model2.data);
            if (model2Outputs.length > 0) {
                outputs.push({
                    modelName: combination.model2.name,
                    mediaItems: model2Outputs,
                    modelIndex: combination.model2.index
                });
            }

            // ÈöèÊú∫Êâì‰π±ËæìÂá∫È°∫Â∫è
            const shuffledOutputs = shuffleArray(outputs);

            // Ê†πÊçÆËæìÂá∫Êï∞ÈáèÂä®ÊÄÅËÆæÁΩÆÁΩëÊ†ºÂ∏ÉÂ±Ä
            const totalItems = shuffledOutputs.length;
            
            if (totalItems === 1) {
                // ‰∏∫Âçï‰∏™ÁªìÊûúÊ∑ªÂä†ÁâπÊÆäÊ†∑Âºè
                outputGrid.classList.add('single-item');
            } else {
                outputGrid.classList.remove('single-item');
            }
            
            // ‰øùÊåÅÂ∑¶Âè≥pairÂØπÁöÑÂ±ïÁ§∫ÊñπÂºè
            outputGrid.style.gridTemplateColumns = '1fr 1fr';

            shuffledOutputs.forEach((output, index) => {
                const outputItem = document.createElement('div');
                outputItem.className = 'output-item';
                outputItem.dataset.modelIndex = output.modelIndex;
                outputItem.dataset.outputIndex = index;

                // ÂàõÂª∫Â™í‰ΩìÂ±ïÁ§∫Âå∫Âüü
                let mediaElements = '';
                output.mediaItems.forEach((mediaItem, mediaIndex) => {
                    if (mediaItem.type === 'video') {
                        mediaElements += `
                            <div class="media-container" onclick="showMediaModal('${mediaItem.url}', 'video', 'ËæìÂá∫ ${mediaIndex + 1}')">
                                <video src="${mediaItem.url}" alt="ËæìÂá∫ÁªìÊûú ${mediaIndex + 1}" class="output-image" preload="metadata">
                                    ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÊí≠Êîæ
                                </video>
                                <div class="media-overlay">
                                    <span class="zoom-icon">‚ñ∂Ô∏è</span>
                                </div>
                            </div>
                        `;
                    } else {
                        // ‰∏∫ÂõæÁâáÊ∑ªÂä†Áº©Áï•ÂõæÂäüËÉΩ
                        const uniqueId = `img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                        // ‰∏∫OSSÂõæÁâáÁîüÊàêÁº©Áï•ÂõæURL
                        const thumbnailUrl = `${mediaItem.url}?x-oss-process=image/format,webp,image/resize,w_512,h_512`;
                        mediaElements += `
                            <div class="media-container" onclick="showMediaModal('${mediaItem.url}', 'image', 'ËæìÂá∫ ${mediaIndex + 1}')">
                                <div class="thumbnail-container">
                                    <img src="${thumbnailUrl}" 
                                         alt="ËæìÂá∫ÁªìÊûú ${mediaIndex + 1}" 
                                         class="thumbnail-image" 
                                         id="thumbnail_${uniqueId}"
                                         onload="onThumbnailLoad('${uniqueId}')"
                                         onerror="onThumbnailError('${uniqueId}')">
                                </div>
                                <div class="media-overlay">
                                    <span class="zoom-icon">üîç</span>
                                </div>
                            </div>
                        `;
                    }
                });

                // Ê∑ªÂä†Â™í‰ΩìÂÆπÂô®ÂåÖË£ÖÔºåÊîØÊåÅÊªöÂä®
                outputItem.innerHTML = `
                    <div class="media-scroll-container">
                        ${mediaElements}
                    </div>
                    <div class="output-info">ÈÄâÈ°π ${index + 1}</div>
                `;

                outputItem.onclick = (e) => {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂ™í‰ΩìÂÆπÂô®Ôºå‰∏çËß¶ÂèëÈÄâÊã©
                    if (e.target.closest('.media-container')) {
                        return;
                    }
                    selectOutput(outputItem, output.modelIndex);
                };
                outputGrid.appendChild(outputItem);
            });
        }

        function extractDisplayInfo(outputItem) {
            const mediaItems = [];
            
            if (!outputItem || !outputItem.output_display_info) {
                return mediaItems;
            }
            
            const displayInfo = outputItem.output_display_info;
            
            // ÊåâÈ°∫Â∫èÊ∑ªÂä†ÂõæÁâá
            if (displayInfo.output_images && Array.isArray(displayInfo.output_images)) {
                displayInfo.output_images.forEach(imageUrl => {
                    if (imageUrl) {
                        mediaItems.push({
                            url: imageUrl,
                            type: 'image'
                        });
                    }
                });
            }
            
            // ÊåâÈ°∫Â∫èÊ∑ªÂä†ËßÜÈ¢ë
            if (displayInfo.output_videos && Array.isArray(displayInfo.output_videos)) {
                displayInfo.output_videos.forEach(videoUrl => {
                    if (videoUrl) {
                        mediaItems.push({
                            url: videoUrl,
                            type: 'video'
                        });
                    }
                });
            }
            
            return mediaItems;
        }

        // È¢ÑÂä†ËΩΩÁº©Áï•ÂõæÂáΩÊï∞
        function preloadThumbnails(combination) {
            const outputs = [];
            
            // Êî∂ÈõÜÊâÄÊúâÂõæÁâáURL
            const model1Outputs = extractDisplayInfo(combination.model1.data);
            const model2Outputs = extractDisplayInfo(combination.model2.data);
            
            [...model1Outputs, ...model2Outputs].forEach(mediaItem => {
                if (mediaItem.type === 'image') {
                    // Âè™È¢ÑÂä†ËΩΩÁº©Áï•ÂõæÔºå‰∏çÈ¢ÑÂä†ËΩΩÂéüÂõæ
                    const thumbnailUrl = `${mediaItem.url}?x-oss-process=image/format,webp,image/resize,w_512,h_512`;
                    if (!preloadManager.isPreloaded(thumbnailUrl)) {
                        const thumbnailImg = new Image();
                        thumbnailImg.src = thumbnailUrl;
                        preloadManager.addPreloadedImage(thumbnailUrl, thumbnailImg);
                        outputs.push(thumbnailImg);
                    }
                }
            });
            
            return outputs;
        }

        // È¢ÑÂä†ËΩΩÁÆ°ÁêÜÂô®
        const preloadManager = {
            preloadedImages: new Map(), // Â≠òÂÇ®Â∑≤È¢ÑÂä†ËΩΩÁöÑÂõæÁâá
            maxPreloadCount: 50, // ÊúÄÂ§ßÈ¢ÑÂä†ËΩΩÊï∞ÈáèÔºåÊîØÊåÅÊõ¥Â§öÁº©Áï•ÂõæÈ¢ÑÂä†ËΩΩ
            
            // Ê∑ªÂä†È¢ÑÂä†ËΩΩÂõæÁâá
            addPreloadedImage(url, image) {
                if (this.preloadedImages.size >= this.maxPreloadCount) {
                    // Â¶ÇÊûúË∂ÖËøáÊúÄÂ§ßÊï∞ÈáèÔºåÂà†Èô§ÊúÄÊó©È¢ÑÂä†ËΩΩÁöÑÂõæÁâá
                    const firstKey = this.preloadedImages.keys().next().value;
                    this.preloadedImages.delete(firstKey);
                }
                this.preloadedImages.set(url, image);
            },
            
            // Ê£ÄÊü•ÂõæÁâáÊòØÂê¶Â∑≤È¢ÑÂä†ËΩΩ
            isPreloaded(url) {
                return this.preloadedImages.has(url);
            },
            
            // Ëé∑ÂèñÈ¢ÑÂä†ËΩΩÁöÑÂõæÁâá
            getPreloadedImage(url) {
                return this.preloadedImages.get(url);
            },
            
            // Ê∏ÖÁêÜÈ¢ÑÂä†ËΩΩÁºìÂ≠ò
            clearCache() {
                this.preloadedImages.clear();
            }
        };

        // Êô∫ËÉΩÈ¢ÑÂä†ËΩΩÂáΩÊï∞ - È¢ÑÂä†ËΩΩÂ§öÈ°µÁº©Áï•Âõæ
        function smartPreloadThumbnails(currentIndex) {
            const preloadCount = 5; // È¢ÑÂä†ËΩΩÊé•‰∏ãÊù•5È°µÁöÑÁº©Áï•Âõæ
            const preloadedPages = new Set();
            
            // Ê£ÄÊµãÁΩëÁªúÁä∂ÂÜµÔºåË∞ÉÊï¥È¢ÑÂä†ËΩΩÁ≠ñÁï•
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            let adjustedPreloadCount = preloadCount;
            
            if (connection) {
                if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
                    adjustedPreloadCount = 1; // ÊÖ¢ÁΩëÁªúÂè™È¢ÑÂä†ËΩΩ1È°µ
                } else if (connection.effectiveType === '3g') {
                    adjustedPreloadCount = 3; // 3GÁΩëÁªúÈ¢ÑÂä†ËΩΩ3È°µ
                } else {
                    adjustedPreloadCount = 5; // 4G/5GÁΩëÁªúÈ¢ÑÂä†ËΩΩ5È°µ
                }
            }
            
            for (let i = 1; i <= adjustedPreloadCount; i++) {
                const nextIndex = currentIndex + i;
                if (nextIndex < testData.totalQuestions && !preloadedPages.has(nextIndex)) {
                    const nextCombination = testData.testCombinations[nextIndex];
                    preloadThumbnails(nextCombination);
                    preloadedPages.add(nextIndex);
                }
            }
        }

        // Áº©Áï•ÂõæÂä†ËΩΩÂÆåÊàê
        function onThumbnailLoad(uniqueId) {
            const thumbnail = document.getElementById(`thumbnail_${uniqueId}`);
            if (thumbnail) {
                thumbnail.classList.add('loaded');
            }
        }

        // Áº©Áï•ÂõæÂä†ËΩΩÂ§±Ë¥•
        function onThumbnailError(uniqueId) {
            const thumbnail = document.getElementById(`thumbnail_${uniqueId}`);
            if (thumbnail) {
                thumbnail.style.display = 'none';
            }
        }

        // ÂÆåÊï¥ÂõæÁâáÂä†ËΩΩÂÆåÊàê
        function onFullImageLoad(uniqueId) {
            const fullImage = document.getElementById(`full_${uniqueId}`);
            if (fullImage) {
                fullImage.classList.add('loaded');
            }
        }

        // ÂÆåÊï¥ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•
        function onFullImageError(uniqueId) {
            const fullImage = document.getElementById(`full_${uniqueId}`);
            if (fullImage) {
                fullImage.style.display = 'none';
            }
        }

        function selectOutput(outputItem, modelIndex) {
            document.querySelectorAll('.output-item').forEach(item => {
                item.classList.remove('selected');
            });
            outputItem.classList.add('selected');

            const currentCombination = testData.testCombinations[testData.currentIndex];
            const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;
            
            // ‰øùÁïôÂ∑≤ÊúâÁöÑÂÅèÂ•ΩÂéüÂõ†
            const existingReason = testData.userPreferences[combinationKey]?.preferenceReason || "";
            
            testData.userPreferences[combinationKey] = {
                testId: currentCombination.testId,
                model1Name: currentCombination.model1.name,
                model2Name: currentCombination.model2.name,
                selectedModelIndex: modelIndex,
                selectedModelName: testData.outputData[modelIndex].name,
                preferenceReason: existingReason,
                timestamp: new Date().toISOString()
            };

            // Ëá™Âä®‰øùÂ≠òËøõÂ∫¶
            saveTestProgress();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = testData.currentIndex === 0;
            
            if (testData.currentIndex === testData.totalQuestions - 1) {
                nextBtn.textContent = 'ÂÆåÊàêÊµãËØï ‚úÖ';
            } else {
                nextBtn.textContent = '‰∏ã‰∏ÄÈ¢ò ‚û°Ô∏è';
            }
        }

        document.getElementById('prevBtn').onclick = () => {
            if (testData.currentIndex > 0) {
                testData.currentIndex--;
                loadCurrentQuestion();
            }
        };

        document.getElementById('nextBtn').onclick = () => {
            const currentCombination = testData.testCombinations[testData.currentIndex];
            const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;

            if (!testData.userPreferences[combinationKey]) {
                alert('ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËæìÂá∫ÁªìÊûú');
                return;
            }

            if (testData.currentIndex === testData.totalQuestions - 1) {
                showResults();
            } else {
                testData.currentIndex++;
                loadCurrentQuestion();
            }
        };

        function showResults() {
            // Â¶ÇÊûúÂΩìÂâçÈ¢òÁõÆÊú™ÂÆåÊàêÔºåËØ¢ÈóÆÊòØÂê¶ÁªßÁª≠
            const currentCombination = testData.testCombinations[testData.currentIndex];
            const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;
            
            if (!testData.userPreferences[combinationKey]) {
                if (!confirm('ÂΩìÂâçÈ¢òÁõÆÂ∞öÊú™ÂÆåÊàêÔºåÊòØÂê¶‰ªçË¶ÅÊü•ÁúãÁªìÊûúÔºü')) {
                    return;
                }
            }
            
            testSection.style.display = 'none';
            resultsSection.style.display = 'block';
            
            // ÈöêËóèÊ†áÈ¢òÂå∫Âüü‰ª•ËäÇÁúÅÁ©∫Èó¥
            document.querySelector('.header').style.display = 'none';
            
            displayResults();
            
            // Â¶ÇÊûúÊµãËØïÂÆåÊàêÁéáËææÂà∞100%ÔºåËá™Âä®ÂØºÂá∫ÁªìÊûú
            const stats = calculateStats();
            if (stats.completionRate === 100) {
                setTimeout(() => {
                    if (confirm('ÊµãËØïÂ∑≤ÂÆåÊàêÔºÅÊòØÂê¶Ëá™Âä®ÂØºÂá∫ÊµãËØïÁªìÊûúÔºü')) {
                        exportResults();
                    }
                }, 1000);
            }
        }

        function displayResults() {
            const stats = calculateStats();
            const modelStats = calculateModelStats();
            
            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            updateProgressBar(stats.completionRate);
            
            // Êõ¥Êñ∞ËØ¶ÁªÜÁªüËÆ°
            const summaryStats = document.getElementById('summaryStats');
            summaryStats.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${stats.totalQuestions}</div>
                    <div class="stat-label">ÊÄªÈ¢òÁõÆÊï∞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.completedQuestions}</div>
                    <div class="stat-label">Â∑≤ÂÆåÊàê</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.completionRate}%</div>
                    <div class="stat-label">ÂÆåÊàêÁéá</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.outputModels}</div>
                    <div class="stat-label">ÂØπÊØîÊ®°ÂûãÊï∞</div>
                </div>
            `;
            
            // Êõ¥Êñ∞Ê®°ÂûãÂØπÊØîÂõæË°®
            updateModelChart(modelStats);
            
            // Êõ¥Êñ∞ELOËØÑÂàÜÊéíÂêç
            updateEloRanking();
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            updateResultButtons(stats.completionRate);
        }

        function updateProgressBar(completionRate) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = `${completionRate}%`;
            progressText.textContent = `${completionRate}%`;
            
            // Ê†πÊçÆÂÆåÊàêÁéáÊîπÂèòÈ¢úËâ≤
            if (completionRate < 50) {
                progressBar.style.backgroundColor = '#e53e3e';
            } else if (completionRate < 100) {
                progressBar.style.backgroundColor = '#d69e2e';
            } else {
                progressBar.style.backgroundColor = '#48bb78';
            }
        }

        function updateModelChart(modelStats) {
            const chartContainer = document.getElementById('chartContainer');
            
            // ÂàõÂª∫ÁÆÄÂçïÁöÑÊü±Áä∂Âõæ
            let chartHTML = '<div style="padding: 20px; display: flex; align-items: end; height: 100%; gap: 10px;">';
            
            Object.entries(modelStats).forEach(([modelName, stats]) => {
                const winRate = parseFloat(stats.winRate) || 0;
                const barHeight = (winRate / 100) * 200; // ÊúÄÂ§ßÈ´òÂ∫¶200px
                
                chartHTML += `
                    <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                   height: ${barHeight}px; width: 100%; border-radius: 4px 4px 0 0; 
                                   margin-bottom: 10px; position: relative;">
                            <div style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); 
                                       color: #2d3748; font-weight: bold; font-size: 14px; 
                                       background: white; padding: 2px 6px; border-radius: 4px; 
                                       box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                                ${winRate}%
                            </div>
                        </div>
                        <div style="font-size: 12px; text-align: center; color: #4a5568; 
                                   max-width: 100px; word-wrap: break-word;">${modelName}</div>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            chartContainer.innerHTML = chartHTML;
        }

        function updateResultButtons(completionRate) {
            const continueBtn = document.getElementById('continueTestBtn');
            const viewDetailsBtn = document.getElementById('viewDetailsBtn');
            
            // Â¶ÇÊûúÊòØÂØºÂÖ•ÁöÑÁªìÊûúÔºåÊòæÁ§∫ÁâπÊÆäÁöÑÊü•ÁúãËØ¶ÊÉÖÊåâÈíÆ
            if (testData.isImportedResult) {
                viewDetailsBtn.style.display = 'inline-block';
                viewDetailsBtn.textContent = 'üìã Êü•ÁúãÊµãËØïËØ¶ÊÉÖ';
                viewDetailsBtn.onclick = showImportedResultDetails; // ÁªëÂÆöÂØºÂÖ•ÁªìÊûúËØ¶ÊÉÖÂáΩÊï∞
                continueBtn.style.display = 'none'; // ÂØºÂÖ•ÁªìÊûúÊó∂‰∏çÊòæÁ§∫ÁªßÁª≠ÊµãËØïÊåâÈíÆ
                return;
            }
            
            // ÁªßÁª≠ÊµãËØïÊåâÈíÆÂßãÁªàÊòæÁ§∫
            continueBtn.style.display = 'inline-block';
            
            if (completionRate < 100) {
                continueBtn.textContent = 'üîÑ ÁªßÁª≠ÊµãËØï';
            } else {
                continueBtn.textContent = 'üìã Êü•ÁúãÊµãËØïËØ¶ÊÉÖ';
            }
            
            // Ê≠£Â∏∏ÊµãËØïÊµÅÁ®ã‰∏çÊòæÁ§∫"Êü•ÁúãËØ¶ÁªÜÁªìÊûú"ÊåâÈíÆ
            viewDetailsBtn.style.display = 'none';
        }

        function continueTest() {
            const stats = calculateStats();
            
            if (stats.completionRate < 100) {
                // Êú™ÂÆåÊàêÊµãËØïÔºåÁªßÁª≠ÊµãËØï
                resultsSection.style.display = 'none';
                testSection.style.display = 'block';
                loadCurrentQuestion();
            } else {
                // Â∑≤ÂÆåÊàêÊµãËØïÔºåÊòæÁ§∫ËØ¶ÁªÜÁöÑÊµãËØïËØ¶ÊÉÖÈÄâÊã©ÁïåÈù¢
                showDetailedTestSelector();
            }
        }

        function showDetailedTestSelector() {
            const stats = calculateStats();
            
            // ÂàõÂª∫ËØ¶ÁªÜÁöÑÊµãËØïËØ¶ÊÉÖÈÄâÊã©ÁïåÈù¢
            const modalHTML = `
                <div class="test-detail-modal" id="detailedTestModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>üìã ÊµãËØïËØ¶ÊÉÖÊü•Áúã</h3>
                            <button class="close-btn" onclick="closeDetailedTestModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="test-navigation">
                                <h4>üìä ÊµãËØïÊ¶ÇËßà</h4>
                                <div class="result-overview">
                                    <p><strong>ÊÄªÈ¢òÁõÆÊï∞:</strong> ${testData.totalQuestions}</p>
                                    <p><strong>ÂèÇ‰∏éÊ®°Âûã:</strong> ${outputModels.join(', ')}</p>
                                    <p><strong>ÂÆåÊàêÁéá:</strong> ${stats.completionRate}%</p>
                                    <p><strong>ÂÆåÊàêÊó∂Èó¥:</strong> ${new Date().toLocaleString()}</p>
                                </div>
                                
                                <h4>üéØ Áî®Êà∑ÈÄâÊã©ËØ¶ÊÉÖÔºàÁÇπÂáªÂèØËøõÂÖ•ÊµãËØïÔºâ</h4>
                                <div class="choice-details">
                                    ${generateDetailedChoiceDetails()}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂà∞È°µÈù¢
            if (!document.getElementById('detailedTestModal')) {
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('detailedTestModal').style.display = 'block';
        }

        function generateDetailedChoiceDetails() {
            let detailsHTML = '';
            
            // ÊåâÊó∂Èó¥ÊéíÂ∫èÁî®Êà∑ÈÄâÊã©
            const sortedPreferences = Object.entries(testData.userPreferences)
                .sort((a, b) => new Date(a[1].timestamp) - new Date(b[1].timestamp));
            
            sortedPreferences.forEach(([key, pref], index) => {
                const testNumber = index + 1;
                const choiceTime = new Date(pref.timestamp).toLocaleString();
                const preferenceReason = pref.preferenceReason || 'Êó†';
                
                // ÊâæÂà∞ÂØπÂ∫îÁöÑÊµãËØïÁªÑÂêàÁ¥¢Âºï
                const testIndex = testData.testCombinations.findIndex(combination => {
                    const combinationKey = `${combination.testId}_${combination.model1.index}_${combination.model2.index}`;
                    return combinationKey === key;
                });
                
                detailsHTML += `
                    <div class="choice-item" onclick="navigateToTest(${testIndex})" style="cursor: pointer;">
                        <div class="choice-header">
                            <span class="choice-number">È¢òÁõÆ ${testNumber}</span>
                            <span class="choice-time">${choiceTime}</span>
                        </div>
                        <div class="choice-content">
                            <p><strong>ÊµãËØïID:</strong> ${pref.testId}</p>
                            <p><strong>ÂØπÊØîÊ®°Âûã:</strong> ${pref.model1Name} vs ${pref.model2Name}</p>
                            <p><strong>ÈÄâÊã©ÁªìÊûú:</strong> <span class="selected-model-highlight">${pref.selectedModelName}</span></p>
                            <p><strong>ÈÄâÊã©ÂéüÂõ†:</strong> ${preferenceReason}</p>
                        </div>
                    </div>
                `;
            });
            
            return detailsHTML;
        }

        function generateDetailedTestList() {
            let testListHTML = '';
            
            testData.testCombinations.forEach((combination, index) => {
                const combinationKey = `${combination.testId}_${combination.model1.index}_${combination.model2.index}`;
                const hasAnswer = testData.userPreferences[combinationKey];
                const statusClass = hasAnswer ? 'completed' : 'incomplete';
                const statusText = hasAnswer ? '‚úÖ Â∑≤ÂÆåÊàê' : '‚è≥ Êú™ÂÆåÊàê';
                const selectedModel = hasAnswer ? testData.userPreferences[combinationKey].selectedModelName : 'Êú™ÈÄâÊã©';
                
                testListHTML += `
                    <div class="test-item ${statusClass}" onclick="navigateToTest(${index})">
                        <div class="test-info">
                            <div class="test-number">È¢òÁõÆ ${index + 1}</div>
                            <div class="test-id">ID: ${combination.testId}</div>
                            <div class="test-models">${combination.model1.name} vs ${combination.model2.name}</div>
                        </div>
                        <div class="test-status">
                            <div class="status-text">${statusText}</div>
                            ${hasAnswer ? `<div class="selected-model">ÈÄâÊã©: ${selectedModel}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            return testListHTML;
        }

        function closeDetailedTestModal() {
            const modal = document.getElementById('detailedTestModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function showTestDetailSelector() {
            // ÂàõÂª∫ÊµãËØïËØ¶ÊÉÖÈÄâÊã©ÁïåÈù¢
            const modalHTML = `
                <div class="test-detail-modal" id="testDetailModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>üìã ÊµãËØïËØ¶ÊÉÖÊü•Áúã</h3>
                            <button class="close-btn" onclick="closeTestDetailModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="test-navigation">
                                <h4>ÈÄâÊã©Ë¶ÅÊü•ÁúãÁöÑÊµãËØïÈ¢òÁõÆÔºö</h4>
                                <div class="test-list" id="testList">
                                    ${generateTestList()}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂà∞È°µÈù¢
            if (!document.getElementById('testDetailModal')) {
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('testDetailModal').style.display = 'block';
        }

        function generateTestList() {
            let testListHTML = '';
            
            testData.testCombinations.forEach((combination, index) => {
                const combinationKey = `${combination.testId}_${combination.model1.index}_${combination.model2.index}`;
                const hasAnswer = testData.userPreferences[combinationKey];
                const statusClass = hasAnswer ? 'completed' : 'incomplete';
                const statusText = hasAnswer ? '‚úÖ Â∑≤ÂÆåÊàê' : '‚è≥ Êú™ÂÆåÊàê';
                const selectedModel = hasAnswer ? testData.userPreferences[combinationKey].selectedModelName : 'Êú™ÈÄâÊã©';
                
                testListHTML += `
                    <div class="test-item ${statusClass}" onclick="navigateToTest(${index})">
                        <div class="test-info">
                            <div class="test-number">È¢òÁõÆ ${index + 1}</div>
                            <div class="test-id">ID: ${combination.testId}</div>
                            <div class="test-models">${combination.model1.name} vs ${combination.model2.name}</div>
                        </div>
                        <div class="test-status">
                            <div class="status-text">${statusText}</div>
                            ${hasAnswer ? `<div class="selected-model">ÈÄâÊã©: ${selectedModel}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            return testListHTML;
        }

        function navigateToTest(index) {
            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            closeTestDetailModal();
            
            // ËÆæÁΩÆÂΩìÂâçÈ¢òÁõÆÁ¥¢Âºï
            testData.currentIndex = index;
            
            // ÂàáÊç¢Âà∞ÊµãËØïÈ°µÈù¢
            resultsSection.style.display = 'none';
            testSection.style.display = 'block';
            
            // Âä†ËΩΩÊåáÂÆöÈ¢òÁõÆ
            loadCurrentQuestion();
        }

        function closeTestDetailModal() {
            const modal = document.getElementById('testDetailModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function goHome() {
            if (confirm('Á°ÆÂÆöË¶ÅÂõûÂà∞ÂºÄÂßãÁïåÈù¢ÂêóÔºüÂΩìÂâçÊµãËØïËøõÂ∫¶Â∑≤‰øùÂ≠ò„ÄÇ')) {
                // ÊòæÁ§∫Ê†áÈ¢òÂå∫Âüü
                document.querySelector('.header').style.display = 'block';
                
                // ÊòæÁ§∫‰∏ä‰º†Âå∫Âüü
                uploadSection.style.display = 'block';
                testSection.style.display = 'none';
                resultsSection.style.display = 'none';
                
                // ‰∏çÈáçÁΩÆcurrentTestKeyÔºå‰øùÊåÅÁºìÂ≠ò‰ø°ÊÅØÊòæÁ§∫
                // currentTestKey = null;
                updateCacheInfo();
            }
        }

        function showDetailedResults() {
            const modelStats = calculateModelStats();
            let detailsHTML = '<h3>üìä ËØ¶ÁªÜÊµãËØïÁªìÊûú</h3>';
            
            // Ê®°ÂûãËØ¶ÁªÜÁªüËÆ°
            detailsHTML += '<div class="detailed-stats">';
            Object.entries(modelStats).forEach(([modelName, stats]) => {
                detailsHTML += `
                    <div class="model-detail">
                        <h4>${modelName}</h4>
                        <p>ËÉúÁéá: ${stats.winRate}</p>
                        <p>ËÉúÂà©Ê¨°Êï∞: ${stats.wins}/${stats.total}</p>
                        <p>ÂèÇ‰∏éÂØπÊØî: ${stats.total} Ê¨°</p>
                    </div>
                `;
            });
            detailsHTML += '</div>';
            
            // Áî®Êà∑ÈÄâÊã©ËØ¶ÊÉÖ
            detailsHTML += '<h3>üéØ Áî®Êà∑ÈÄâÊã©ËØ¶ÊÉÖ</h3>';
            detailsHTML += '<div class="choice-details">';
            Object.entries(testData.userPreferences).forEach(([key, pref]) => {
                detailsHTML += `
                    <div class="choice-item">
                        <p><strong>È¢òÁõÆ ${pref.testId}:</strong> ${pref.model1Name} vs ${pref.model2Name}</p>
                        <p>ÈÄâÊã©: ${pref.selectedModelName}</p>
                        <p>Êó∂Èó¥: ${new Date(pref.timestamp).toLocaleString()}</p>
                    </div>
                `;
            });
            detailsHTML += '</div>';
            
            alert('ËØ¶ÁªÜÁªìÊûúÂ∑≤ÂáÜÂ§áÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞ËæìÂá∫');
            console.log('ËØ¶ÁªÜÊµãËØïÁªìÊûú:', detailsHTML);
            console.log('Ê®°ÂûãÁªüËÆ°:', modelStats);
            console.log('Áî®Êà∑ÈÄâÊã©:', testData.userPreferences);
        }

        document.getElementById('exportBtn').onclick = exportResults;

        function exportResults() {
            // Êõ¥Êñ∞ELOËØÑÂàÜ
            eloSystem.updateFromPreferences(testData.userPreferences, outputModels);
            const eloRankings = eloSystem.getAllRatings().sort((a, b) => b.rating - a.rating);
            
            // ÊèêÂèñËæìÂÖ•‰ø°ÊÅØ
            const inputInfo = {};
            Object.keys(testData.inputData).forEach(testId => {
                if (testId !== 'test_info') { // Ë∑≥Ëøátest_infoÂ≠óÊÆµ
                    const inputItem = testData.inputData[testId];
                    inputInfo[testId] = {
                        actionId: inputItem.action_id || null,
                        threadId: inputItem.thread_id || null,
                        testId: inputItem.test_id || testId,
                        testCase: inputItem.test_case || null
                    };
                }
            });
            
            const results = {
                testInfo: {
                    timestamp: new Date().toISOString(),
                    totalQuestions: testData.totalQuestions,
                    outputModels: outputModels,
                    completionRate: calculateStats().completionRate
                },
                inputInfo: inputInfo,
                userPreferences: testData.userPreferences,
                modelStats: calculateModelStats(),
                eloRankings: eloRankings.map((item, index) => ({
                    rank: index + 1,
                    model: item.model,
                    eloRating: item.rating
                }))
            };

            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `blind_test_results_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            link.click();
            URL.revokeObjectURL(url);

            alert('ÁªìÊûúÂ∑≤ÂØºÂá∫ÔºÅ');
        }

        function calculateStats() {
            const totalQuestions = testData.totalQuestions;
            const completedQuestions = Object.keys(testData.userPreferences).length;
            const completionRate = totalQuestions > 0 ? Math.round((completedQuestions / totalQuestions) * 100) : 0;
            
            // ‰øÆÂ§çÂØπÊØîÊ®°ÂûãÊï∞ËÆ°ÁÆóÔºö‰ΩøÁî®outputModelsÊï∞ÁªÑÈïøÂ∫¶
            const outputModelsCount = outputModels.length;

            return {
                totalQuestions,
                completedQuestions,
                completionRate,
                outputModels: outputModelsCount
            };
        }

        function calculateModelStats() {
            const modelStats = {};
            
            // ÂàùÂßãÂåñÊâÄÊúâÊ®°ÂûãÁöÑÁªüËÆ°
            outputModels.forEach(model => {
                modelStats[model] = { wins: 0, total: 0, comparisons: [] };
            });

            // ÁªüËÆ°ÊØè‰∏™ÂØπÊØîÁöÑÁªìÊûú
            Object.values(testData.userPreferences).forEach(pref => {
                if (pref.selectedModelName) {
                    modelStats[pref.selectedModelName].wins++;
                    modelStats[pref.selectedModelName].comparisons.push({
                        testId: pref.testId,
                        opponent: pref.selectedModelName === pref.model1Name ? pref.model2Name : pref.model1Name,
                        result: 'win'
                    });
                    
                    // ËÆ∞ÂΩïÂØπÊâãÁöÑÂ§±Ë¥•
                    const opponent = pref.selectedModelName === pref.model1Name ? pref.model2Name : pref.model1Name;
                    modelStats[opponent].comparisons.push({
                        testId: pref.testId,
                        opponent: pref.selectedModelName,
                        result: 'lose'
                    });
                }
            });

            // ËÆ°ÁÆóÊÄªÂØπÊØîÊ¨°Êï∞ÂíåËÉúÁéá
            Object.keys(modelStats).forEach(model => {
                const comparisons = modelStats[model].comparisons;
                modelStats[model].total = comparisons.length;
                modelStats[model].winRate = modelStats[model].total > 0 ? 
                    (modelStats[model].wins / modelStats[model].total * 100).toFixed(1) + '%' : '0%';
            });

            return modelStats;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('AIÊ®°ÂûãÁõ≤ÊµãÂπ≥Âè∞Â∑≤Âä†ËΩΩ');
            updateCacheInfo();
        });

        function showMediaModal(url, type, title) {
            const modalMedia = document.getElementById('modalMedia');
            const modalTitle = document.getElementById('modalTitle');

            if (type === 'video') {
                modalMedia.innerHTML = `
                    <video src="${url}" controls style="max-width: 100%; max-height: 70vh; object-fit: contain;">
                        ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÊí≠Êîæ
                    </video>
                `;
            } else {
                // ÂÖàÊòæÁ§∫Áº©Áï•Âõæ
                const thumbnailUrl = `${url}?x-oss-process=image/format,webp,image/resize,w_512,h_512`;
                modalMedia.innerHTML = `
                    <img id="modalImg" src="${thumbnailUrl}" style="max-width: 100%; max-height: 70vh; object-fit: contain; filter: blur(0.2px); transition: filter 0.3s;" alt="${title}">
                `;
                // ÂêéÂè∞Âä†ËΩΩÂéüÂõæÔºåÂä†ËΩΩÂÆåÂêéÊõøÊç¢srcÂπ∂ÂéªÈô§Ê®°Á≥ä
                const img = new Image();
                img.onload = function() {
                    const modalImg = document.getElementById('modalImg');
                    if (modalImg) {
                        modalImg.src = url;
                        modalImg.style.filter = 'none';
                    }
                };
                img.onerror = function() {
                    // Âä†ËΩΩÂ§±Ë¥•Êó∂‰øùÊåÅÁº©Áï•ÂõæÂπ∂ÂéªÈô§Ê®°Á≥ä
                    const modalImg = document.getElementById('modalImg');
                    if (modalImg) {
                        modalImg.style.filter = 'none';
                    }
                };
                img.src = url;
            }

            // ‰ΩøÁî®ÈÄöÁî®Ê†áÈ¢òÔºå‰∏çÊòæÁ§∫Ê®°Âûã‰ø°ÊÅØ
            modalTitle.textContent = 'Â™í‰ΩìÈ¢ÑËßà';
            document.getElementById('mediaModal').style.display = 'block';
        }

        function closeMediaModal() {
            document.getElementById('mediaModal').style.display = 'none';
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        window.onclick = function(event) {
            const modal = document.getElementById('mediaModal');
            if (event.target === modal) {
                closeMediaModal();
            }
        }

        // ÈîÆÁõò‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞
        function handleKeyDown(event) {
            // Âè™Âú®ÊµãËØïÁïåÈù¢Êó∂ÂìçÂ∫îÈîÆÁõò‰∫ã‰ª∂
            if (testSection.style.display === 'none') {
                return;
            }

            // Â¶ÇÊûúÊ®°ÊÄÅÊ°ÜÊâìÂºÄÔºå‰∏çÂìçÂ∫îÈîÆÁõò‰∫ã‰ª∂
            if (document.getElementById('mediaModal').style.display === 'block') {
                return;
            }

            // Â¶ÇÊûúÊñáÊú¨Ê°ÜËÅöÁÑ¶Ôºå‰∏çÂìçÂ∫îÈîÆÁõò‰∫ã‰ª∂ÔºàÈô§‰∫ÜÊñπÂêëÈîÆÔºâ
            const activeElement = document.activeElement;
            if (activeElement && activeElement.id === 'preferenceReason') {
                // Âú®ÊñáÊú¨Ê°Ü‰∏≠ÔºåÂè™ÂÖÅËÆ∏ÊñπÂêëÈîÆÂíåTabÈîÆ
                if (event.key === 'ArrowLeft' || event.key === 'ArrowRight' || 
                    event.key === 'ArrowUp' || event.key === 'ArrowDown' || 
                    event.key === 'Tab') {
                    return; // ÂÖÅËÆ∏ÈªòËÆ§Ë°å‰∏∫
                }
                // ÂÖ∂‰ªñÊåâÈîÆÔºàÂåÖÊã¨EnterÔºâÂú®ÊñáÊú¨Ê°Ü‰∏≠‰∏çËß¶ÂèëÊµãËØïÂäüËÉΩ
                return;
            }

            switch(event.key) {
                case 'ArrowLeft':
                    event.preventDefault();
                    // Â∑¶ÊñπÂêëÈîÆÔºöÈÄâÊã©Á¨¨‰∏Ä‰∏™ÈÄâÈ°π
                    selectOutputByIndex(0);
                    break;
                case 'ArrowRight':
                    event.preventDefault();
                    // Âè≥ÊñπÂêëÈîÆÔºöÈÄâÊã©Á¨¨‰∫å‰∏™ÈÄâÈ°π
                    selectOutputByIndex(1);
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    // ‰∏äÊñπÂêëÈîÆÔºö‰∏ä‰∏ÄÈ¢ò
                    if (testData.currentIndex > 0) {
                        testData.currentIndex--;
                        loadCurrentQuestion();
                    }
                    break;
                case 'ArrowDown':
                    event.preventDefault();
                    // ‰∏ãÊñπÂêëÈîÆÔºö‰∏ã‰∏ÄÈ¢ò
                    const currentCombination = testData.testCombinations[testData.currentIndex];
                    const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;
                    
                    if (testData.userPreferences[combinationKey]) {
                        if (testData.currentIndex < testData.totalQuestions - 1) {
                            testData.currentIndex++;
                            loadCurrentQuestion();
                        } else {
                            // ÊúÄÂêé‰∏ÄÈ¢òÔºåÂÆåÊàêÊµãËØï
                            showResults();
                        }
                    } else {
                        alert('ËØ∑ÂÖàÈÄâÊã©ÂΩìÂâçÈ¢òÁõÆÁöÑÁ≠îÊ°à');
                    }
                    break;
                case 'Enter':
                    event.preventDefault();
                    // Â¶ÇÊûúÂΩìÂâçÈ¢òÁõÆÂ∑≤ÈÄâÊã©ÔºåËøõÂÖ•‰∏ã‰∏ÄÈ¢ò
                    const currentCombinationEnter = testData.testCombinations[testData.currentIndex];
                    const combinationKeyEnter = `${currentCombinationEnter.testId}_${currentCombinationEnter.model1.index}_${currentCombinationEnter.model2.index}`;
                    if (testData.userPreferences[combinationKeyEnter]) {
                        document.getElementById('nextBtn').click();
                    }
                    break;
            }
        }

        // Ê†πÊçÆÁ¥¢ÂºïÈÄâÊã©ËæìÂá∫
        function selectOutputByIndex(index) {
            const outputItems = document.querySelectorAll('.output-item');
            if (index < outputItems.length) {
                const outputItem = outputItems[index];
                const modelIndex = parseInt(outputItem.dataset.modelIndex);
                selectOutput(outputItem, modelIndex);
            }
        }

        // ÁîüÊàêÊµãËØïÁöÑÂîØ‰∏ÄÊ†áËØÜ
        function generateTestKey(inputData, outputData) {
            // ‰ΩøÁî®ÁÆÄÂçïÁöÑÂ≠óÁ¨¶‰∏≤ÊãºÊé•ÂíåÂìàÂ∏åÊù•ÁîüÊàêÂîØ‰∏ÄÊ†áËØÜ
            const inputStr = JSON.stringify(inputData);
            const outputStr = outputData.map(output => 
                output.name + JSON.stringify(output.data)
            ).join('|');
            
            // ÁÆÄÂçïÁöÑÂìàÂ∏åÂáΩÊï∞
            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // ËΩ¨Êç¢‰∏∫32‰ΩçÊï¥Êï∞
                }
                return Math.abs(hash).toString(36);
            }
            
            const inputHash = simpleHash(inputStr).slice(0, 8);
            const outputHash = simpleHash(outputStr).slice(0, 8);
            
            return `test_${inputHash}_${outputHash}`;
        }

        // ‰øùÂ≠òÊµãËØïËøõÂ∫¶Âà∞Êú¨Âú∞Â≠òÂÇ®
        function saveTestProgress() {
            if (!currentTestKey) return;
            
            const progress = {
                testKey: currentTestKey,
                currentIndex: testData.currentIndex,
                userPreferences: testData.userPreferences,
                totalQuestions: testData.totalQuestions,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem(`wob_progress_${currentTestKey}`, JSON.stringify(progress));
            updateCacheInfo();
        }

        // Ê∏ÖÈô§ÁâπÂÆöÊµãËØïÁöÑÁºìÂ≠ò
        function clearTestCache(testKey) {
            localStorage.removeItem(`wob_progress_${testKey}`);
            updateCacheInfo();
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊµãËØïËøõÂ∫¶
        function loadTestProgress(testKey) {
            const savedProgress = localStorage.getItem(`wob_progress_${testKey}`);
            if (savedProgress) {
                try {
                    const progress = JSON.parse(savedProgress);
                    testData.currentIndex = progress.currentIndex || 0;
                    testData.userPreferences = progress.userPreferences || {};
                    testData.totalQuestions = progress.totalQuestions || 0;
                    return true;
                } catch (error) {
                    console.error('Âä†ËΩΩÁºìÂ≠òÂ§±Ë¥•:', error);
                }
            }
            return false;
        }

        // Êõ¥Êñ∞ÁºìÂ≠ò‰ø°ÊÅØÊòæÁ§∫
        function updateCacheInfo() {
            const cacheInfo = document.getElementById('cacheInfo');
            if (!currentTestKey) {
                cacheInfo.innerHTML = 'ÊöÇÊó†ÁºìÂ≠òÊï∞ÊçÆ';
                return;
            }

            const savedProgress = localStorage.getItem(`wob_progress_${currentTestKey}`);
            if (savedProgress) {
                try {
                    const progress = JSON.parse(savedProgress);
                    const completedCount = Object.keys(progress.userPreferences || {}).length;
                    const completionRate = progress.totalQuestions > 0 ? 
                        Math.round((completedCount / progress.totalQuestions) * 100) : 0;
                    
                    cacheInfo.innerHTML = `
                        <strong>ÂΩìÂâçÊµãËØïËøõÂ∫¶:</strong> ${completedCount}/${progress.totalQuestions} (${completionRate}%)<br>
                        <small>ÊúÄÂêéÊõ¥Êñ∞: ${new Date(progress.timestamp).toLocaleString()}</small>
                    `;
                } catch (error) {
                    cacheInfo.innerHTML = 'ÁºìÂ≠òÊï∞ÊçÆÊçüÂùè';
                }
            } else {
                cacheInfo.innerHTML = 'ÊöÇÊó†ÁºìÂ≠òÊï∞ÊçÆ';
            }
        }

        // Ê∏ÖÈô§ÊâÄÊúâÁºìÂ≠ò
        function clearAllCache() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊµãËØïÁºìÂ≠òÂêóÔºüËøôÂ∞ÜÂà†Èô§ÊâÄÊúâ‰øùÂ≠òÁöÑÊµãËØïËøõÂ∫¶„ÄÇ')) {
                const keys = Object.keys(localStorage);
                const wobKeys = keys.filter(key => key.startsWith('wob_progress_'));
                wobKeys.forEach(key => localStorage.removeItem(key));
                
                alert('ÊâÄÊúâÁºìÂ≠òÂ∑≤Ê∏ÖÈô§ÔºÅ');
                updateCacheInfo();
                
                // Â¶ÇÊûúÂΩìÂâçÂú®ÊµãËØï‰∏≠ÔºåÈáçÁΩÆËøõÂ∫¶
                if (testSection.style.display !== 'none') {
                    testData.currentIndex = 0;
                    testData.userPreferences = {};
                    loadCurrentQuestion();
                }
            }
        }

        // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèØÊÅ¢Â§çÁöÑÊµãËØï
        function checkForResumableTest(inputData, outputData) {
            const testKey = generateTestKey(inputData, outputData);
            const savedProgress = localStorage.getItem(`wob_progress_${testKey}`);
            
            if (savedProgress) {
                try {
                    const progress = JSON.parse(savedProgress);
                    const completedCount = Object.keys(progress.userPreferences || {}).length;
                    
                    if (completedCount > 0) {
                        if (completedCount < progress.totalQuestions) {
                            // Êú™ÂÆåÊàêÁöÑÊµãËØï
                            const shouldContinue = confirm(`ÂèëÁé∞Êú™ÂÆåÊàêÁöÑÊµãËØïËøõÂ∫¶ (${completedCount}/${progress.totalQuestions})ÔºåÊòØÂê¶ÁªßÁª≠Ôºü`);
                            return shouldContinue; // ËøîÂõûÁî®Êà∑ÁöÑÈÄâÊã©
                        } else {
                            // Â∑≤ÂÆåÊàêÁöÑÊµãËØï
                            const choice = confirm(`ÂèëÁé∞Â∑≤ÂÆåÊàêÁöÑÊµãËØï (${completedCount}/${progress.totalQuestions})ÔºÅ

ÈÄâÊã©"Á°ÆÂÆö"Êü•ÁúãÊµãËØïÁªìÊûú
ÈÄâÊã©"ÂèñÊ∂à"ÈáçÊñ∞ÂºÄÂßãÊµãËØï`);
                            if (choice) {
                                // Áî®Êà∑ÈÄâÊã©Êü•ÁúãÁªìÊûúÔºåÁõ¥Êé•Âä†ËΩΩÊï∞ÊçÆÂπ∂ÊòæÁ§∫ÁªìÊûúÈ°µÈù¢
                                testData.inputData = inputData;
                                testData.outputData = outputData;
                                testData.userPreferences = progress.userPreferences;
                                testData.totalQuestions = progress.totalQuestions;
                                testData.currentIndex = 0;
                                testData.isImportedResult = false; // ÈáçÁΩÆÂØºÂÖ•ÁªìÊûúÊ†áËÆ∞
                                
                                // ËÆæÁΩÆËæìÂá∫Ê®°Âûã
                                outputModels = outputData.map(item => item.name);
                                
                                // ÁîüÊàêÊµãËØïÁªÑÂêàÔºàÁî®‰∫éÁªüËÆ°ËÆ°ÁÆóÔºâ
                                const validTestIds = validateData(inputData, outputData);
                                testData.testCombinations = generateTestCombinations(outputData, validTestIds);
                                
                                // Áõ¥Êé•ÊòæÁ§∫ÁªìÊûúÈ°µÈù¢
                                uploadSection.style.display = 'none';
                                testSection.style.display = 'none';
                                resultsSection.style.display = 'block';
                                
                                // ÊòæÁ§∫Ê†áÈ¢òÂå∫Âüü
                                document.querySelector('.header').style.display = 'block';
                                
                                // ÊòæÁ§∫ÁªìÊûú
                                displayResults();
                                return 'completed'; // ËøîÂõûÁâπÊÆäÂÄºÔºåË°®Á§∫Â∑≤Â§ÑÁêÜÂÆåÊàêÊµãËØï
                            } else {
                                // Áî®Êà∑ÈÄâÊã©ÈáçÊñ∞ÂºÄÂßãÔºåÊ∏ÖÁ©∫ÁºìÂ≠ò
                                clearTestCache(testKey);
                                return false; // ÈáçÊñ∞ÂºÄÂßãÊµãËØï
                            }
                        }
                    }
                } catch (error) {
                    console.error('Ê£ÄÊü•ÁºìÂ≠òÂ§±Ë¥•:', error);
                }
            }
            return false; // Ê≤°ÊúâÁºìÂ≠òÔºåÂºÄÂßãÊñ∞ÊµãËØï
        }

        // ELOËØÑÂàÜÁ≥ªÁªü
        class EloRating {
            constructor(kFactor = 32) {
                this.kFactor = kFactor;
                this.ratings = new Map();
                this.initialRating = 1500;
            }

            // Ëé∑ÂèñÊàñÂàùÂßãÂåñÊ®°ÂûãËØÑÂàÜ
            getRating(modelName) {
                if (!this.ratings.has(modelName)) {
                    this.ratings.set(modelName, this.initialRating);
                }
                return this.ratings.get(modelName);
            }

            // ËÆ°ÁÆóÊúüÊúõËÉúÁéá
            getExpectedScore(ratingA, ratingB) {
                return 1 / (1 + Math.pow(10, (ratingB - ratingA) / 400));
            }

            // Êõ¥Êñ∞ËØÑÂàÜ
            updateRating(winner, loser) {
                const ratingWinner = this.getRating(winner);
                const ratingLoser = this.getRating(loser);
                
                const expectedWinner = this.getExpectedScore(ratingWinner, ratingLoser);
                const expectedLoser = this.getExpectedScore(ratingLoser, ratingWinner);
                
                const newRatingWinner = ratingWinner + this.kFactor * (1 - expectedWinner);
                const newRatingLoser = ratingLoser + this.kFactor * (0 - expectedLoser);
                
                this.ratings.set(winner, newRatingWinner);
                this.ratings.set(loser, newRatingLoser);
                
                return {
                    winner: { old: ratingWinner, new: newRatingWinner, change: newRatingWinner - ratingWinner },
                    loser: { old: ratingLoser, new: newRatingLoser, change: newRatingLoser - ratingLoser }
                };
            }

            // Ëé∑ÂèñÊâÄÊúâËØÑÂàÜ
            getAllRatings() {
                return Array.from(this.ratings.entries()).map(([model, rating]) => ({
                    model,
                    rating: Math.round(rating)
                }));
            }

            // Ê†πÊçÆÁî®Êà∑ÈÄâÊã©Êõ¥Êñ∞ËØÑÂàÜ
            updateFromPreferences(userPreferences, outputModels) {
                // ÈáçÁΩÆËØÑÂàÜ
                this.ratings.clear();
                
                // ÂàùÂßãÂåñÊâÄÊúâÊ®°ÂûãÁöÑËØÑÂàÜ
                outputModels.forEach(model => {
                    this.ratings.set(model, this.initialRating);
                });
                
                // Ê†πÊçÆÁî®Êà∑ÈÄâÊã©Êõ¥Êñ∞ËØÑÂàÜ
                Object.values(userPreferences).forEach(pref => {
                    if (pref.selectedModelName) {
                        const winner = pref.selectedModelName;
                        const loser = winner === pref.model1Name ? pref.model2Name : pref.model1Name;
                        this.updateRating(winner, loser);
                    }
                });
            }
        }

        // ÂÖ®Â±ÄELOËØÑÂàÜÂÆû‰æã
        let eloSystem = new EloRating();

        function updateEloRanking() {
            const eloContainer = document.getElementById('eloContainer');
            
            // Êõ¥Êñ∞ELOËØÑÂàÜ
            eloSystem.updateFromPreferences(testData.userPreferences, outputModels);
            
            // Ëé∑ÂèñÊéíÂ∫èÂêéÁöÑËØÑÂàÜ
            const rankings = eloSystem.getAllRatings()
                .sort((a, b) => b.rating - a.rating);
            
            if (rankings.length === 0) {
                eloContainer.innerHTML = '<p style="text-align: center; color: #718096;">ÊöÇÊó†ËØÑÂàÜÊï∞ÊçÆ</p>';
                return;
            }
            
            let eloHTML = '';
            rankings.forEach((item, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';
                
                eloHTML += `
                    <div class="elo-item">
                        <div class="elo-rank">
                            <div class="rank-number ${rankClass}">${rank}</div>
                            <div class="model-name">${item.model}</div>
                        </div>
                        <div class="elo-score">
                            <div class="score-value">${item.rating}</div>
                        </div>
                    </div>
                `;
            });
            
            eloContainer.innerHTML = eloHTML;
        }

        // ‰øùÂ≠òÂÅèÂ•ΩÂéüÂõ†
        function savePreferenceReason() {
            const currentCombination = testData.testCombinations[testData.currentIndex];
            const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;
            const reasonText = document.getElementById('preferenceReason').value.trim();
            
            // Â¶ÇÊûúÂ≠òÂú®Áî®Êà∑ÂÅèÂ•ΩËÆ∞ÂΩïÔºåÂàôÊõ¥Êñ∞ÂÅèÂ•ΩÂéüÂõ†
            if (testData.userPreferences[combinationKey]) {
                testData.userPreferences[combinationKey].preferenceReason = reasonText || "";
            } else {
                // Â¶ÇÊûúËøòÊ≤°ÊúâÈÄâÊã©Á≠îÊ°àÔºåÂÖàÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÁöÑÂÅèÂ•ΩËÆ∞ÂΩïÊù•‰øùÂ≠òÂéüÂõ†
                testData.userPreferences[combinationKey] = {
                    testId: currentCombination.testId,
                    model1Name: currentCombination.model1.name,
                    model2Name: currentCombination.model2.name,
                    selectedModelIndex: null,
                    selectedModelName: null,
                    preferenceReason: reasonText || "",
                    timestamp: new Date().toISOString()
                };
            }
            
            // Ëá™Âä®‰øùÂ≠òËøõÂ∫¶
            saveTestProgress();
        }

        // Âä†ËΩΩÂÅèÂ•ΩÂéüÂõ†
        function loadPreferenceReason() {
            const currentCombination = testData.testCombinations[testData.currentIndex];
            const combinationKey = `${currentCombination.testId}_${currentCombination.model1.index}_${currentCombination.model2.index}`;
            const reasonTextarea = document.getElementById('preferenceReason');
            
            // Ê∏ÖÁ©∫ÊñáÊú¨Ê°Ü
            reasonTextarea.value = '';
            
            // ‰ªéuserPreferences‰∏≠Âä†ËΩΩÂ∑≤‰øùÂ≠òÁöÑÂÅèÂ•ΩÂéüÂõ†
            if (testData.userPreferences[combinationKey] && testData.userPreferences[combinationKey].preferenceReason) {
                reasonTextarea.value = testData.userPreferences[combinationKey].preferenceReason;
            }
        }

        function showImportedResultDetails() {
            // ÂàõÂª∫ÂØºÂÖ•ÁªìÊûúËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü
            const modalHTML = `
                <div class="test-detail-modal" id="importedResultModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>üìã ÂØºÂÖ•ÁªìÊûúËØ¶ÊÉÖ</h3>
                            <button class="close-btn" onclick="closeImportedResultModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="imported-result-details">
                                <h4>üìä ÊµãËØïÊ¶ÇËßà</h4>
                                <div class="result-overview">
                                    <p><strong>ÊÄªÈ¢òÁõÆÊï∞:</strong> ${testData.totalQuestions}</p>
                                    <p><strong>ÂèÇ‰∏éÊ®°Âûã:</strong> ${outputModels.join(', ')}</p>
                                    <p><strong>ÂÆåÊàêÊó∂Èó¥:</strong> ${testData.userPreferences[Object.keys(testData.userPreferences)[0]]?.timestamp ? new Date(testData.userPreferences[Object.keys(testData.userPreferences)[0]].timestamp).toLocaleString() : 'Êú™Áü•'}</p>
                                </div>
                                
                                <h4>üéØ Áî®Êà∑ÈÄâÊã©ËØ¶ÊÉÖ</h4>
                                <div class="choice-details">
                                    ${generateImportedChoiceDetails()}
                                </div>
                                
                                <div class="imported-result-note">
                                    <p><strong>Ê≥®ÊÑè:</strong> Áî±‰∫éËøôÊòØÂØºÂÖ•ÁöÑÂéÜÂè≤ÁªìÊûúÔºåÊó†Ê≥ïÊü•ÁúãÂÖ∑‰ΩìÁöÑËæìÂÖ•ËæìÂá∫ÂÜÖÂÆπ„ÄÇÂ¶ÇÈúÄÊü•ÁúãÂÆåÊï¥ÊµãËØïÂÜÖÂÆπÔºåËØ∑‰ΩøÁî®ÂéüÂßãËæìÂÖ•ÂíåËæìÂá∫Êñá‰ª∂ÈáçÊñ∞ËøõË°åÊµãËØï„ÄÇ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂà∞È°µÈù¢
            if (!document.getElementById('importedResultModal')) {
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('importedResultModal').style.display = 'block';
        }

        function generateImportedChoiceDetails() {
            let detailsHTML = '';
            
            // ÊåâÊó∂Èó¥ÊéíÂ∫èÁî®Êà∑ÈÄâÊã©
            const sortedPreferences = Object.entries(testData.userPreferences)
                .sort((a, b) => new Date(a[1].timestamp) - new Date(b[1].timestamp));
            
            sortedPreferences.forEach(([key, pref], index) => {
                const testNumber = index + 1;
                const choiceTime = new Date(pref.timestamp).toLocaleString();
                const preferenceReason = pref.preferenceReason || 'Êó†';
                
                detailsHTML += `
                    <div class="choice-item">
                        <div class="choice-header">
                            <span class="choice-number">È¢òÁõÆ ${testNumber}</span>
                            <span class="choice-time">${choiceTime}</span>
                        </div>
                        <div class="choice-content">
                            <p><strong>ÊµãËØïID:</strong> ${pref.testId}</p>
                            <p><strong>ÂØπÊØîÊ®°Âûã:</strong> ${pref.model1Name} vs ${pref.model2Name}</p>
                            <p><strong>ÈÄâÊã©ÁªìÊûú:</strong> <span class="selected-model-highlight">${pref.selectedModelName}</span></p>
                            <p><strong>ÈÄâÊã©ÂéüÂõ†:</strong> ${preferenceReason}</p>
                        </div>
                    </div>
                `;
            });
            
            return detailsHTML;
        }

        function closeImportedResultModal() {
            const modal = document.getElementById('importedResultModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>